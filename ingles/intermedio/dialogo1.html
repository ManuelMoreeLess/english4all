<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dialogue Comprehension Quiz</title>
    <style>
        :root { --primary-color: #8e44ad; --secondary-color: #9b59b6; --bg-color: #f4f6f7; --card-bg: #ffffff; --border-color: #dcdde1; --text-color: #34495e; --success-color: #2ecc71; --danger-color: #e74c3c; --success-bg: #eafaf1; --danger-bg: #f9ebea; --timer-color: #e67e22;}
        body { font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        .container { max-width: 800px; margin: 20px auto; background-color: var(--card-bg); border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 30px; }
        h1 { text-align: center; color: var(--primary-color); }
        .instructions { background-color: #fdf9e7; border-left: 5px solid #f1c40f; padding: 15px; margin: 20px 0; border-radius: 5px; }
        #dialogue-container { font-family: 'Courier New', Courier, monospace; background-color: #fafafa; border: 1px solid var(--border-color); padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        #dialogue-container p { margin: 5px 0; }
        
        .controls { text-align: center; margin-bottom: 25px; }
        button { background-color: var(--primary-color); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.2s ease-in-out; }
        button:hover { background-color: var(--secondary-color); transform: translateY(-1px); }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        #speak-btn.active { background-color: #e67e22; }

        #quiz-section { border-top: 2px solid var(--primary-color); padding-top: 20px; }
        #timer { font-size: 1.5em; font-weight: bold; text-align: center; color: var(--timer-color); margin-bottom: 15px; }
        .question-block { margin-bottom: 20px; }
        .question-block p { font-weight: bold; }
        .quiz-option { display: block; background-color: #f9f9f9; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; margin: 5px 0; cursor: pointer; }
        .quiz-option.selected { background-color: #ddeaff; }
        .quiz-option.correct { background-color: var(--success-bg) !important; border-left: 5px solid var(--success-color); }
        .quiz-option.incorrect { background-color: var(--danger-bg) !important; border-left: 5px solid var(--danger-color); }
        #results { text-align: center; font-weight: bold; padding: 15px; border-radius: 5px; margin-top: 20px; }
        
        @media (max-width: 600px) { .container { padding: 15px; } button { width: 100%; margin-top: 10px; } }

        /* ==== IN√çCIO: CSS do bot√£o Quiz Vocabulary ==== */
        .botao-link {
          background-color: var(--primary-color);
          color: white;
          padding: 10px 20px;
          font-size: 16px;
          text-decoration: none;
          border-radius: 8px;
          display: inline-block;
          transition: background-color 0.3s;
          font-weight: bold;
          margin-top: 20px;
        }
        .botao-link:hover {
          background-color: var(--secondary-color);
        }
        /* ==== FIM: CSS do bot√£o Quiz Vocabulary ==== */
    </style>
</head>
<body>
    <div class="container">
        <h1>Dialogue Comprehension Quiz</h1>
        <div class="instructions">
            <p><strong>Instru√ß√£o:</strong> Primeiro, leia o di√°logo abaixo. Em seguida, clique em "Read Aloud" para ouvir o √°udio.</p>
            <ul style="columns: 2; -webkit-columns: 2; -moz-columns: 2;">
                <li>beauty/barber salon ‚Äì sal√£o de beleza / barbearia</li>
                <li>beach service ‚Äì servi√ßo de praia</li>
                <li>car rental ‚Äì aluguel de carros</li>
                <li>child care service ‚Äì servi√ßo de cuidado de crian√ßas</li>
                <li>convention center ‚Äì centro de conven√ß√µes</li>
                <li>disco ‚Äì danceteria</li>
                <li>games saloon & games ‚Äì sal√£o de jogos</li>
                <li>handicap access ‚Äì acesso para pessoas com defici√™ncia</li>
                <li>heliport ‚Äì heliponto</li>
                <li>medical service ‚Äì servi√ßo m√©dico</li>
                <li>safe deposit box ‚Äì cofre de seguran√ßa</li>
                <li>travel agency ‚Äì ag√™ncia de viagens</li>
                <li>tickets booking service ‚Äì servi√ßo de reserva de ingressos</li>
                <li>water sports ‚Äì esportes aqu√°ticos</li>
            </ul>

            <!-- ==== BOT√ÉO: Link para o Quiz Vocabulary ==== -->
            <div style="text-align: center;">
              <a href="Vocabullary.html" class="botao-link">üìò Quiz Vocabulary</a>
            </div>
        </div>
        <div id="dialogue-container">
           üå¥ Peter & Mary ‚Äì Hotel Conversation

            Peter: Wow, Mary, this hotel is amazing! Did you see that they have a beach service? We can order drinks right from the sunbed!

            Mary: I know, it‚Äôs perfect! And I booked us a massage at the beauty salon this afternoon. They also have a barber salon, if you want to trim your beard.

            Peter: Not a bad idea. Oh, and guess what? There‚Äôs a car rental desk in the lobby. We could rent a car and explore the city tomorrow!

            Mary: Great! And if we decide to go out at night, the hotel has a disco! I haven‚Äôt danced in ages.

            Peter: Haha, me neither! Oh, I checked the map earlier ‚Äî there‚Äôs even a games saloon. We could play pool or something tonight.

            Mary: Awesome! And look at that sign: they have handicap access everywhere. That‚Äôs really thoughtful for people who need it.

            Peter: Totally. And did you see the rooftop? There's a heliport! I wonder if they offer helicopter tours.

            Mary: That would be exciting! By the way, I saw a medical service office near the spa. It‚Äôs good to know, just in case.

            Peter: Yeah, it's always good to be safe. Speaking of safety, our room has a safe deposit box ‚Äî I already put our passports and cash in there.

            Mary: Smart! Oh, and I stopped by the travel agency in the hotel earlier. They‚Äôre offering a tour to the nearby island this weekend.

            Peter: Let‚Äôs book it! Did you use the tickets booking service at the front desk?

            Mary: Not yet. I thought we could do it together. They‚Äôre also offering water sports activities ‚Äî wanna try jet skiing?

            Peter: Absolutely! This vacation just keeps getting better. I‚Äôm so glad we chose this hotel.

            Mary: Me too, Peter. Let‚Äôs make the most of this week!
        </div>
        <div class="controls">
            <button id="speak-btn" onclick="toggleSpeak()">üîä Read Aloud</button>
            <button id="start-quiz-btn" onclick="startQuiz()">üß† Start Quiz</button>
        </div>
        
        <div id="quiz-section" style="display:none;">
            <!-- O timer foi ocultado com style="display:none;" -->
            <div id="timer" style="display:none;">03:00</div>
            <div id="quiz-container"></div>
            <div id="results"></div>
            <button id="submit-btn" onclick="submitQuiz()">Enviar Respostas</button>
            <button id="retry-btn" onclick="location.reload()" style="display:none; background-color: #e67e22;">Retry Quiz</button>
        </div>
    </div>
    
    <script>
        const quizData = [
            { question: "What service did Mary book for the afternoon?", answer: "A massage at the beauty salon", options: ["A haircut", "A facial treatment", "A massage at the beauty salon", "A gym class"] },
            { question: "What did Peter suggest to explore the city?", answer: "Rent a car", options: ["Book a tour", "Walk around", "Take a taxi", "Rent a car"] },
            { question: "Where can they dance at the hotel?", answer: "At the disco", options: ["In the garden", "At the disco", "On the rooftop", "In the games saloon"] },
            { question: "What game might they play at the games saloon?", answer: "Pool", options: ["Chess", "Pool", "Volleyball", "Ping pong"] },
            { question: "What does Peter say about the handicap access?", answer: "It‚Äôs thoughtful", options: ["It‚Äôs complicated", "It‚Äôs thoughtful", "It‚Äôs expensive", "It‚Äôs unnecessary"] },
            { question: "What unusual feature does the hotel rooftop have?", answer: "A heliport", options: ["A swimming pool", "A caf√©", "A heliport", "A cinema"] },
            { question: "Why is the medical service important according to Mary?", answer: "In case of emergencies", options: ["For sports injuries", "In case of emergencies", "For cosmetic procedures", "To get medicine"] },
            { question: "What did Peter use to protect their valuables?", answer: "In the safe deposit box", options: ["Under the bed", "In the drawer", "In the safe deposit box", "Behind the TV"] },
            { question: "What tour did Mary learn about at the travel agency?", answer: "A nearby island tour", options: ["A trip to a volcano", "A city tour", "A museum visit", "A nearby island tour"] },
            { question: "What water sport do they want to try?", answer: "Jet skiing", options: ["Surfing", "Jet skiing", "Sailing", "Snorkeling"] }
        ];

        let voices = [];
        let femaleVoice = null;
        let timerInterval = null;
        let speechApiIsReady = false;

        function populateVoiceList() {
            if (typeof speechSynthesis === 'undefined') {
                return;
            }
            voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
                femaleVoice = voices.find(v => v.lang.startsWith('en') && (v.name.includes('Female') || v.name.includes('Zira') || v.name.includes('Google US English'))) || voices.find(v => v.lang.startsWith('en'));
                speechApiIsReady = true;
                
                if(window.speechSynthesisInterval) {
                    clearInterval(window.speechSynthesisInterval);
                }
                window.speechSynthesisInterval = setInterval(() => {
                    if (speechSynthesis.paused) speechSynthesis.resume();
                }, 14000);
            }
        }

        if (typeof speechSynthesis !== 'undefined') {
            populateVoiceList();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = populateVoiceList;
            }
        } else {
            document.getElementById('speak-btn').disabled = true;
            document.getElementById('speak-btn').textContent = '‚ùå Speech Not Supported';
        }

        function toggleSpeak() {
            const speakBtn = document.getElementById('speak-btn');
            
            if (!speechApiIsReady) {
                alert('A API de fala ainda n√£o est√° pronta. Tente novamente em um segundo.');
                return;
            }

            if (speechSynthesis.speaking) {
                speechSynthesis.pause();
                speakBtn.textContent = '‚ñ∂Ô∏è Resume';
                speakBtn.classList.remove('active');
            } else if (speechSynthesis.paused) {
                speechSynthesis.resume();
                speakBtn.textContent = '‚è∏Ô∏è Pause';
                speakBtn.classList.add('active');
            } else {
                speechSynthesis.cancel();
                const textToSpeak = document.getElementById('dialogue-container').textContent;
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                
                if (femaleVoice) {
                    utterance.voice = femaleVoice;
                }
                utterance.lang = 'en-US';
                
                utterance.onend = () => {
                    speakBtn.textContent = 'üîä Read Aloud';
                    speakBtn.classList.remove('active');
                };
                utterance.onerror = (event) => {
                    console.error('SpeechSynthesisUtterance.onerror', event);
                    alert('Ocorreu um erro ao tentar reproduzir o √°udio: ' + event.error);
                    speakBtn.textContent = 'üîä Read Aloud';
                    speakBtn.classList.remove('active');
                };

                speechSynthesis.speak(utterance);
                speakBtn.textContent = '‚è∏Ô∏è Pause';
                speakBtn.classList.add('active');
            }
        }
        
        function startQuiz() {
            document.getElementById('start-quiz-btn').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';
            
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = '';
            quizData.forEach((item, index) => {
                const block = document.createElement('div');
                block.className = 'question-block';
                const shuffledOptions = [...item.options].sort(() => Math.random() - 0.5);
                block.innerHTML = `<p>${index + 1}. ${item.question}</p>`;
                shuffledOptions.forEach(opt => {
                    block.innerHTML += `<label class="quiz-option"><input type="radio" name="q${index}" value="${opt.replace(/"/g, '"')}"> ${opt}</label>`;
                });
                quizContainer.appendChild(block);
            });
            // A chamada para iniciar o timer foi comentada para desativ√°-lo
            // startTimer(180); 
        }

        function startTimer(duration) {
            let timer = duration, minutes, seconds;
            const timerDisplay = document.getElementById('timer');
            timerInterval = setInterval(() => {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                timerDisplay.textContent = minutes + ":" + seconds;
                if (--timer < 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's Up!";
                    submitQuiz(true); 
                }
            }, 1000);
        }

        function submitQuiz(timeUp = false) {
            // Se o timer estiver desativado, n√£o √© necess√°rio limpar o intervalo
            if(timerInterval) {
                clearInterval(timerInterval);
            }
            
            let score = 0;
            quizData.forEach((item, index) => {
                const selectedRadio = document.querySelector(`input[name="q${index}"]:checked`);
                const options = document.querySelectorAll(`input[name="q${index}"]`);
                options.forEach(opt => {
                    const label = opt.parentElement;
                    opt.disabled = true;
                    label.style.cursor = 'default';
                    if (opt.value === item.answer) {
                        label.classList.add('correct');
                    } else if (selectedRadio && opt.value === selectedRadio.value) {
                        label.classList.add('incorrect');
                    }
                });
                if (selectedRadio && selectedRadio.value === item.answer) {
                    score++;
                }
            });

            const percentage = ((score / quizData.length) * 100).toFixed(0);
            const resultsDiv = document.getElementById('results');
            let resultMessage = `You scored ${score} out of ${quizData.length} (${percentage}%)!`;
            if (timeUp) {
                resultMessage = `<h2>Time's Up!</h2><p>${resultMessage}</p>`;
            }
            resultsDiv.innerHTML = resultMessage;
            
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('retry-btn').style.display = 'block';
        }
    </script>
</body>
</html>
