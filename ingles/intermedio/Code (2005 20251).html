<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tradutor H√≠brido</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        :root {
            --primary-color: #007bff;
            --secondary-color: #f8f9fa;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --text-color: #343a40;
            --card-background: #ffffff;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: var(--card-background);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 30px 40px;
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 { color: var(--primary-color); margin-bottom: 10px; font-weight: 600; }
        .pt-to-en h1 { color: var(--success-color); }

        p { margin-bottom: 25px; color: #6c757d; font-size: 1rem; }

        .text-input {
            width: 100%; height: 120px; padding: 15px; border-radius: 8px;
            border: 1px solid #ced4da; font-family: 'Poppins', sans-serif;
            font-size: 1rem; resize: vertical; margin-bottom: 20px;
        }

        .button-group { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .btn {
            color: white; border: none; border-radius: 8px;
            padding: 12px 25px; font-size: 1.1rem; font-weight: 600;
            cursor: pointer; width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn:hover:enabled { transform: translateY(-2px); }
        .btn:disabled { background-color: #6c757d; cursor: not-allowed; transform: translateY(0); }
        #translate-btn { background-color: var(--primary-color); }
        #stop-btn { background-color: var(--danger-color); }
        #stop-btn.hidden { display: none; }

        .output-section {
            margin-top: 30px; text-align: left;
            border-top: 1px solid #e9ecef; padding-top: 20px;
        }
        .output-box {
            background-color: var(--secondary-color); border-radius: 8px;
            padding: 20px; margin-bottom: 20px; min-height: 50px;
            word-wrap: break-word;
        }
        .output-box h3 { display: flex; align-items: center; font-size: 1.1rem; margin-bottom: 10px; }
        .output-box h3 .icon { margin-right: 8px; }
        .en-to-pt .output-box h3 { color: var(--primary-color); }
        .pt-to-en .output-box h3 { color: var(--success-color); }

        /* Estilos para o tradutor por voz */
        #speech-status {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--info-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
        }
        @keyframes blink { 50% { opacity: 0.3; } }
        .listening-indicator {
            width: 12px; height: 12px;
            background-color: var(--danger-color);
            border-radius: 50%;
            margin-right: 10px;
            animation: blink 1.5s infinite;
        }
        #transcript-box {
            background-color: #f1f3f5;
            color: #495057;
            font-style: italic;
        }
    </style>
</head>
<body>

    <!-- TRADUTOR 1: INGL√äS -> PORTUGU√äS (TEXTO) -->
    <div class="container en-to-pt">
        <h1>Tradutor Falante (Ingl√™s ‚Üí Portugu√™s)</h1>
        <p>Insira o texto em ingl√™s para ouvi-lo e ver a tradu√ß√£o.</p>
        <textarea id="en-text-input" class="text-input" placeholder="Digite ou cole um texto em ingl√™s aqui..."></textarea>
        <div class="button-group">
            <button id="translate-btn" class="btn">Ler e Traduzir</button>
            <button id="stop-btn" class="btn hidden">Parar Leitura</button>
        </div>
        <div class="output-section">
            <div class="output-box">
                <h3><span class="icon">üîä</span>Texto Original</h3>
                <p id="original-text-en"></p>
            </div>
            <div class="output-box">
                <h3><span class="icon">üáßüá∑</span>Tradu√ß√£o para Portugu√™s</h3>
                <p id="translated-text-pt">A tradu√ß√£o aparecer√° aqui...</p>
            </div>
        </div>
    </div>

    <!-- TRADUTOR 2: PORTUGU√äS -> INGL√äS (VOZ) -->
    <div class="container pt-to-en">
        <h1>Tradutor por Voz (Portugu√™s ‚Üí Ingl√™s)</h1>
        <div id="speech-status">Aguardando permiss√£o do microfone...</div>
        <div class="output-section">
            <div id="transcript-box" class="output-box">
                <h3><span class="icon">üé§</span>Texto Capturado (Portugu√™s)</h3>
                <p id="transcript-text">...</p>
            </div>
            <div class="output-box">
                <h3><span class="icon">üá∫üá∏</span>Tradu√ß√£o para Ingl√™s</h3>
                <p id="translated-text-en">A tradu√ß√£o aparecer√° aqui...</p>
            </div>
        </div>
    </div>

    <script>
        // --- API DE FALA (SpeechSynthesis) E TRADU√á√ÉO ---
        const synth = window.speechSynthesis;
        let femaleEnglishVoice;
        
        // --- FUN√á√ïES GLOBAIS ---
        function loadVoices() {
            const voices = synth.getVoices();
            femaleEnglishVoice = voices.find(v => v.lang.startsWith('en-') && (v.name.includes('Female') || v.gender === 'female')) || voices.find(v => v.lang.startsWith('en-'));
        }

        async function translateText(text, langPair) {
            const apiUrl = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langPair}`;
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            if (data.responseData) return data.responseData.translatedText;
            throw new Error("Formato de resposta da API inv√°lido.");
        }
        
        // --- TRADUTOR 1 (EN -> PT | TEXTO) ---
        const enTextInput = document.getElementById('en-text-input');
        const translateBtn = document.getElementById('translate-btn');
        const stopBtn = document.getElementById('stop-btn');
        const originalTextEnElem = document.getElementById('original-text-en');
        const translatedTextPtElem = document.getElementById('translated-text-pt');

        function setEnUiState(isProcessing) {
            translateBtn.disabled = isProcessing;
            translateBtn.textContent = isProcessing ? 'Processando...' : 'Ler e Traduzir';
            stopBtn.classList.toggle('hidden', !isProcessing && !synth.speaking);
        }

        function speakText(text) {
            if (synth.speaking) synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.onstart = () => setEnUiState(true);
            utterance.onend = () => setEnUiState(false);
            utterance.onerror = () => { alert("Erro ao ler o texto."); setEnUiState(false); };
            if (femaleEnglishVoice) utterance.voice = femaleEnglishVoice;
            utterance.lang = 'en-US';
            synth.speak(utterance);
        }

        async function handleEnToPt() {
            const text = enTextInput.value.trim();
            if (!text) return alert("Por favor, insira um texto em ingl√™s.");
            setEnUiState(true);
            originalTextEnElem.textContent = text;
            translatedTextPtElem.textContent = 'Traduzindo...';
            speakText(text);
            try {
                const translation = await translateText(text, 'en|pt');
                translatedTextPtElem.textContent = translation;
            } catch (error) {
                translatedTextPtElem.textContent = "Erro ao traduzir.";
            }
        }
        translateBtn.addEventListener('click', handleEnToPt);
        stopBtn.addEventListener('click', () => synth.cancel());


        // --- TRADUTOR 2 (PT -> EN | VOZ) ---
        const speechStatusElem = document.getElementById('speech-status');
        const transcriptTextElem = document.getElementById('transcript-text');
        const translatedTextEnElem = document.getElementById('translated-text-en');
        
        // Verifica se o navegador suporta a API
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (window.SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = true; // Continua ouvindo
            recognition.interimResults = true; // Mostra resultados parciais

            recognition.onstart = () => {
                speechStatusElem.innerHTML = '<div class="listening-indicator"></div>Ouvindo...';
            };

            recognition.onerror = (event) => {
                if (event.error === 'not-allowed') {
                    speechStatusElem.textContent = '‚ùå Microfone n√£o permitido.';
                    alert('Voc√™ precisa permitir o acesso ao microfone nas configura√ß√µes do seu navegador para usar esta funcionalidade.');
                } else {
                    speechStatusElem.textContent = 'Erro. Tentando reiniciar...';
                }
            };
            
            recognition.onend = () => {
                // Reinicia automaticamente para escuta cont√≠nua
                recognition.start();
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                
                // Mostra o que est√° sendo capturado em tempo real
                transcriptTextElem.textContent = transcriptTextElem.textContent === '...' ? finalTranscript + interimTranscript : transcriptTextElem.textContent.split('...')[0] + interimTranscript;

                // Quando uma frase final √© detectada, traduz.
                if (finalTranscript) {
                    transcriptTextElem.textContent = finalTranscript;
                    handlePtToEn(finalTranscript.trim());
                }
            };

            async function handlePtToEn(text) {
                if (!text) return;
                speechStatusElem.textContent = 'üîÑ Processando tradu√ß√£o...';
                translatedTextEnElem.textContent = 'Traduzindo...';
                try {
                    const translation = await translateText(text, 'pt|en');
                    translatedTextEnElem.textContent = translation;
                } catch (error) {
                    translatedTextEnElem.textContent = "Erro ao traduzir.";
                }
            }

            // Inicia a escuta assim que a p√°gina carrega
            try {
                recognition.start();
            } catch(e) {
                 speechStatusElem.textContent = '‚ùå Erro ao iniciar. Clique para tentar.';
                 speechStatusElem.style.cursor = 'pointer';
                 speechStatusElem.onclick = () => recognition.start();
            }

        } else {
            speechStatusElem.textContent = "Seu navegador n√£o suporta a tradu√ß√£o por voz.";
        }

        // --- INICIALIZA√á√ÉO GERAL ---
        if (synth.onvoiceschanged !== undefined) synth.onvoiceschanged = loadVoices;
        loadVoices();
    </script>
</body>
</html>